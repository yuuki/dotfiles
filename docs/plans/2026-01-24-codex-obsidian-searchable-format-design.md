# Codex/Claude ログの Markdown 整形（全文検索最適化）設計

## 目的
Obsidian の全文検索で見つけやすいよう、日次ログの出力形式を整形する。

## 対象
- Codex: `~/.codex/hooks/watch-and-save.sh`
- Claude: `~/.claude/hooks/watch-and-save.sh`

## 方針
1 メッセージを 1 ブロックとして構成し、検索に強い「見出し」と「ブースト行」を追加する。本文はそのまま残す。

## 出力フォーマット
```
## HH:MM Role
- key: <本文1行目を80文字程度に切り出し> / tags: user|codex|claude
<本文全文>

---
```

## 生成ルール
- 見出し: `HH:MM` はローカル時刻、`Role` は `User` / `Codex` / `Claude`。
- `key`: 本文 1 行目を 80 文字程度で切り出し、末尾に `…` を付与（必要な場合のみ）。
- `tags`: 固定語として `user` / `codex` / `claude` のいずれかを必ず含める。
- 既存の除外条件（空文字、`No response requested`、ツール出力など）は維持。
- ブロック末尾に `---` を入れて境界を明確化。

## 期待効果
- 検索語が本文に埋もれても、`key` や `tags` 行でヒットしやすくなる。
- 役割・時刻での絞り込みが容易になる。
- 生ログ本文を保持し、記録性も損なわない。

## 実装メモ
- jq で整形文字列を組み立てて出力するだけで実現可能。
- 既存の保存・コミットフローは変更不要。
