model = "gpt-5.3-codex"
model_reasoning_effort = "xhigh"
hide_agent_reasoning = false
personality = "pragmatic"
collab = true
web_search = "live"

{{- if eq .chezmoi.os "darwin" }}
notify = ["bash", "-lc", "afplay /System/Library/Sounds/Ping.aiff"]
{{- else }}
notify = ["bash", "-lc", ":"]
{{- end }}

[tools]
# full-auto mode
approval_policy = "on-failure"
sandbox_mode    = "workspace-write"
network_access = true

[features]
collaboration_modes = true

[mcp_servers.cclsp]
command = "cclsp"
env = { CCLSP_CONFIG_PATH = "{{ .chezmoi.homeDir }}/.codex/cclsp.json" }

[mcp_servers.playwright]
args = ["@playwright/mcp@latest"]
command = "npx"

{{- $grafanaURL := dig "codex" "grafana" "url" "" . }}
{{- $grafanaToken := dig "codex" "grafana" "service_account_token" "" . }}
{{- $grafanaTokenOpRef := dig "codex" "grafana" "service_account_token_op_ref" "" . }}
{{- if or (ne $grafanaURL "") (or (ne $grafanaToken "") (ne $grafanaTokenOpRef "")) }}
[mcp_servers.grafana]
command = "mcp-grafana"

[mcp_servers.grafana.env]
{{- if ne $grafanaURL "" }}
GRAFANA_URL = "{{ $grafanaURL }}"
{{- end }}
{{- if ne $grafanaTokenOpRef "" }}
GRAFANA_SERVICE_ACCOUNT_TOKEN = "{{ output "op" "read" $grafanaTokenOpRef | trim }}"
{{- else if ne $grafanaToken "" }}
GRAFANA_SERVICE_ACCOUNT_TOKEN = "{{ $grafanaToken }}"
{{- end }}
{{- end }}

# Optional: allow network in workspace-write mode
[sandbox_workspace_write]
network_access = true
{{- $writableRoots := dig "codex" "writable_roots" (list) . }}
writable_roots = [
{{- range $writableRoots }}
  "{{ . }}",
{{- end }}
]

[profiles.full_auto]
approval_policy = "on-request"
sandbox_mode    = "workspace-write"

[profiles.readonly_quiet]
approval_policy = "never"
sandbox_mode    = "read-only"

[projects."/Users/y-tsubouchi/obsidian/research"]
trust_level = "trusted"

[projects."/Users/y-tsubouchi/src/"]
trust_level = "trusted"

[projects."/Users/y-tsubouchi/src/github.com/yuuki/dotfiles"]
trust_level = "trusted"

[notice.model_migrations]
"gpt-5.1-codex-mini" = "gpt-5.1-codex-max"
"gpt-5.1-codex-max" = "gpt-5.2-codex"
"gpt-5.2" = "gpt-5.2-codex"
