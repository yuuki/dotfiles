{{- /* ANTHROPIC_AUTH_TOKEN は1Passwordの "ZAI Auth Token" アイテムの "ANTHROPIC_AUTH_TOKEN" フィールドから取得する */ -}}
{{- $url := env "CHEZMOI_OP_ANTHROPIC_AUTH_TOKEN_OP_URL" -}}
{{- if eq $url "" -}}
{{- $url = "op://Personal/ZAI Auth Token/ANTHROPIC_AUTH_TOKEN" -}}
{{- end -}}
{{- $account := env "CHEZMOI_OP_ACCOUNT_NAME" -}}
{{- $token := "" -}}
{{- if ne $account "" -}}
{{- $token = onepasswordRead $url $account -}}
{{- else -}}
{{- $token = onepasswordRead $url -}}
{{- end -}}
{{- if eq $token "" -}}
{{- fail (printf "1Passwordから ANTHROPIC_AUTH_TOKEN を取得できませんでした（url=%q）。\"ZAI Auth Token\" アイテムの \"ANTHROPIC_AUTH_TOKEN\" フィールドを確認してください" $url) -}}
{{- end -}}
{
  "env": {
    "ENABLE_TOOL_SEARCH": "true",
    "ANTHROPIC_AUTH_TOKEN": {{ $token | toJson }},
    "ANTHROPIC_BASE_URL": "https://api.z.ai/api/anthropic",
    "API_TIMEOUT_MS": "3000000",
    "CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC": 1
  },
  "includeCoAuthoredBy": false,
  "permissions": {
    "allow": [
      "WebFetch(domain:proxy.golang.org)",
      "WebFetch(domain:sum.golang.org)",
      "WebFetch(domain:github.com)",
      "WebFetch(domain:api.github.com)",
      "WebFetch(domain:raw.githubusercontent.com)",
      "WebFetch(domain:gitlab.com)",
      "WebFetch(domain:bitbucket.org)"
    ]
  },
  "mcpServers": {
    "codex": {
      "command": "codex",
      "args": [
        "mcp-server"
      ]
    }
  },
  "hooks": {
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "sh -lc '~/.tmux/bin/update-claude-tmux-status.sh; if command -v terminal-notifier >/dev/null 2>&1; then terminal-notifier -title \"Claude Code\" -message \"Stopped\" -sound Blow; fi'"
          }
        ]
      }
    ],
    "Notification": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo \"Claude Code: $(jq -r '.message')\" | terminal-notifier -title 'Claude Code' -message 'Done' -sound Blow"
          }
        ]
      }
    ]
  },
  "enabledPlugins": {
    "gopls-lsp@claude-plugins-official": true,
    "commit-commands@claude-plugins-official": true,
    "code-review@claude-plugins-official": true,
    "superpowers@claude-plugins-official": true
  },
  "forceLoginMethod": "claudeai",
  "language": "japanese",
  "sandbox": {
    "enabled": true,
    "autoAllowBashIfSandboxed": true
  },
  "alwaysThinkingEnabled": true
}
